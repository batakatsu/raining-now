<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
  </head>
  <body>
    <h1><%= title %></h1>
    <p>Welcome to <%= title %></p>
    <p id="rain_fall">降水量を取得中...</p>
  </body>
</html>
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script type="text/javascript">
!function($){
	$(function(){
		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(
				successCallback, errorCallback
			);
		} else {
			console.error('Geolocation APIに対応してません');
		}
	});

	var RAIN_CHECKER_PATH = '/rain_checker';

	function successCallback (position) {
		console.dir(position);

		var params = {
			lat : position.coords.latitude,
			lng : position.coords.longitude
		};

		$.getJSON(RAIN_CHECKER_PATH, params, function(data) {
			var result_txt = '降水量: ' + data.Rainfall + ' mm/h';
			$('#rain_fall').html(result_txt);
		});
	}

	function errorCallback (error) {
		var message = '';

		switch (error.code) {
			case 1:
				message = '位置情報の利用が許可されていません';
				break;
			case 2:
				message = 'デバイスの位置が判定できません';
				break;
			case 3:
				message = 'タイムアウトしました';
				break;
		}

		console.error(message);
	}
}(jQuery);
</script>
